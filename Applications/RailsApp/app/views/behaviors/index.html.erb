<%= javascript_include_tag 'light' %>
<%= javascript_include_tag 'experimental2' %>

<script>
	var waveStates = {};
	var waveIsSmooths = {};
	var behaviorHash = {};
	<% @behaviors.each do |behavior| %>
		waveStates['<%= behavior.name %>'] = <%= behavior.states %>;
		waveIsSmooths['<%= behavior.name %>'] = <%= behavior.is_smooth %>;
	<% end %>
	$(document).ready(function () {
		$.map($('.view'), function(el, idx) {
			var name = $(el).attr('id');
			var wave = new Wave(name, waveStates[name], waveIsSmooths[name]);
			var behavior = new LP(wave, false);
			behaviorHash[name] = behavior;
			behavior.load($(el));
		});
	});
</script>

<div class='row'>

	<ul class="nav nav-tabs" role="tablist">
		<li><a href="/actuators">Actuators</a></li>
		<li class="active"><a href="/behaviors">Behaviors</a></li>
	</ul>

	<h3>Light Behavior Library</h3>

	<table class="table table-striped">
		<tr>
			<th>ID</th>
			<th></th>
			<th>Name</th>
			<th>Waveform</th>
			<th>Preview</th>
			<th colspan="3"></th>
		</tr>

		<% @behaviors.each do |behavior| %>
		<tr>
			<td><%= behavior.id %></td>
			<td><div class="btn btn-primary play-btn" onclick="behaviorHash['<%= behavior.name %>'].sample(function() {})">Play</div></td>
			<td><%= behavior.name.humanize %></td>
			<td class='view' id='<%= behavior.name %>'></td>
			<td>
				<div class="led-box" data="<%= behavior.name %>">
					<%= render 'partials/led' %>
				</div>
				<div class="field">
				 	Select a preview actuator<br>
				    <%= select("actuation", "actuator_id", Actuator.all.collect {|p| [ p.name.humanize, p.id ] }, {include_blank: 'None'}) %>
				</div>
			</td>
			<td>
				<%= link_to '<span class="glyphicon glyphicon-search"></span>'.html_safe, behavior_path(behavior) %></td>
			<td>
				<%= link_to '<span class="glyphicon glyphicon-edit"></span>'.html_safe, edit_behavior_path(behavior) %></td>
			<td>
				<%= link_to '<span class="glyphicon glyphicon-remove"></span>'.html_safe, behavior_path(behavior),
							method: :delete, data: { confirm: 'Delete behavior?'}
				%>
			</td>
		</tr>
		<% end %>
	</table>
	<%= link_to 'New Behavior', new_behavior_path , {:role => "button", :class => "btn btn-primary"}%>
	<%= link_to 'Mix Behaviors', '/behaviors/new_wave' , {:role => "button", :class => "btn btn-default"}%>

</div>